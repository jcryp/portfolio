<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAPRAVNIK FINANCES - Complete Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: #0a0514;
            color: #e0e6ed;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .grid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }
        
        .shooting-stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(90deg, #a78bfa, transparent);
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(167, 139, 250, 0.4);
            animation: shoot linear;
        }
        
        @keyframes shoot {
            0% { transform: translateX(0) translateY(0); opacity: 1; }
            70% { opacity: 1; }
            100% { transform: translateX(300px) translateY(300px); opacity: 0; }
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.2);
        }
        
        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 50%, #c4b5fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -2px;
        }
        
        .header .subtitle {
            font-size: 0.85em;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 12px 24px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            color: #a78bfa;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.5);
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: #fff;
            border-color: #8b5cf6;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .card {
            background: linear-gradient(135deg, #1e1b2e 0%, #0f0d1a 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            padding: 25px;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #a78bfa);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card:hover {
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(139, 92, 246, 0.15);
        }
        
        .card-title {
            color: #64748b;
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .card-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #e0e6ed;
            margin-bottom: 8px;
        }
        
        .card-value.positive { color: #22c55e; }
        .card-value.negative { color: #ef4444; }
        
        .card-change {
            font-size: 0.85em;
            color: #64748b;
        }
        
        .card-change.positive { color: #22c55e; }
        .card-change.negative { color: #ef4444; }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: linear-gradient(135deg, #1e1b2e 0%, #0f0d1a 100%);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(139, 92, 246, 0.2);
            margin-bottom: 30px;
        }
        
        thead {
            background: rgba(139, 92, 246, 0.1);
        }
        
        th {
            padding: 15px;
            text-align: left;
            color: #64748b;
            font-size: 0.7em;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.05);
            color: #e0e6ed;
        }
        
        tr:hover {
            background: rgba(139, 92, 246, 0.05);
        }
        
        .asset-name {
            font-weight: 700;
            font-size: 1.1em;
            color: #a78bfa;
        }
        
        .positive-value {
            color: #22c55e;
            font-weight: 600;
        }
        
        .negative-value {
            color: #ef4444;
            font-weight: 600;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            font-weight: 900;
            color: #a78bfa;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.2);
        }
        
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0514;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(139, 92, 246, 0.2);
            border-top-color: #a78bfa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-family: 'Playfair Display', serif;
            font-size: 1.5em;
            color: #a78bfa;
            margin-top: 20px;
        }
        
        .allocation-chart {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .allocation-item {
            flex: 1;
            background: linear-gradient(135deg, #1e1b2e 0%, #0f0d1a 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .allocation-label {
            font-size: 0.8em;
            color: #64748b;
            margin-bottom: 10px;
        }
        
        .allocation-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #a78bfa;
        }
        
        .allocation-percent {
            font-size: 1.1em;
            color: #64748b;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="grid-background"></div>
    <div class="shooting-stars" id="shootingStars"></div>
    
    <div id="loadingOverlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Portfolio Data...</div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <h1>NAPRAVNIK FINANCES</h1>
            <p class="subtitle">Multi-Asset Portfolio Dashboard</p>
        </div>
        
        <div class="tab-nav">
            <button class="tab-button active" onclick="switchTab('overview')">ðŸ“Š Overview</button>
            <button class="tab-button" onclick="switchTab('stocks')">ðŸ“ˆ Stocks</button>
            <button class="tab-button" onclick="switchTab('crypto')">â‚¿ Crypto</button>
            <button class="tab-button" onclick="switchTab('commodities')">ðŸ¥‡ Commodities</button>
        </div>
        
        <!-- OVERVIEW TAB -->
        <div id="overview" class="tab-content active">
            <div class="summary-cards">
                <div class="card">
                    <div class="card-title">Total Portfolio Value</div>
                    <div class="card-value" id="overviewTotal">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total Invested</div>
                    <div class="card-value" id="overviewInvested">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total P&L</div>
                    <div class="card-value" id="overviewPnL">$---</div>
                    <div class="card-change" id="overviewROI">---%</div>
                </div>
            </div>
            
            <div class="section-title">Asset Allocation</div>
            <div class="allocation-chart">
                <div class="allocation-item">
                    <div class="allocation-label">Stocks</div>
                    <div class="allocation-value" id="stocksAlloc">$---</div>
                    <div class="allocation-percent" id="stocksPercent">--%</div>
                </div>
                <div class="allocation-item">
                    <div class="allocation-label">Crypto</div>
                    <div class="allocation-value" id="cryptoAlloc">$---</div>
                    <div class="allocation-percent" id="cryptoPercent">--%</div>
                </div>
                <div class="allocation-item">
                    <div class="allocation-label">Commodities</div>
                    <div class="allocation-value" id="commodAlloc">$---</div>
                    <div class="allocation-percent" id="commodPercent">--%</div>
                </div>
            </div>
            
            <div class="section-title">Performance by Asset Class</div>
            <table>
                <thead>
                    <tr>
                        <th>Asset Class</th>
                        <th>Total Invested</th>
                        <th>Current Value</th>
                        <th>P&L</th>
                        <th>ROI %</th>
                    </tr>
                </thead>
                <tbody id="overviewTable"></tbody>
            </table>
        </div>
        
        <!-- STOCKS TAB -->
        <div id="stocks" class="tab-content">
            <div class="summary-cards">
                <div class="card">
                    <div class="card-title">Total â‚¬ Spent</div>
                    <div class="card-value" id="stocksSpent">â‚¬--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total â‚¬ Worth</div>
                    <div class="card-value" id="stocksWorth">â‚¬--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total P&L â‚¬</div>
                    <div class="card-value" id="stocksPnL">â‚¬---</div>
                    <div class="card-change" id="stocksROI">---%</div>
                </div>
            </div>
            
            <div class="section-title">Stock Holdings</div>
            <table>
                <thead>
                    <tr>
                        <th>Ticker</th>
                        <th>Shares</th>
                        <th>Avg Cost</th>
                        <th>Current Price</th>
                        <th>Market Value</th>
                        <th>P&L</th>
                        <th>ROI %</th>
                    </tr>
                </thead>
                <tbody id="stocksBody"></tbody>
            </table>
        </div>
        
        <!-- CRYPTO TAB -->
        <div id="crypto" class="tab-content">
            <div class="summary-cards">
                <div class="card">
                    <div class="card-title">Total Spent</div>
                    <div class="card-value" id="cryptoSpent">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Current Value</div>
                    <div class="card-value" id="cryptoValue">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total P&L</div>
                    <div class="card-value" id="cryptoPnL">$---</div>
                    <div class="card-change" id="cryptoROI">---%</div>
                </div>
            </div>
            
            <div class="section-title">Crypto Holdings</div>
            <table>
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Amount</th>
                        <th>Avg Buy Price</th>
                        <th>Current Price</th>
                        <th>Total Spent</th>
                        <th>Current Value</th>
                        <th>Unrealized P&L</th>
                        <th>% P&L</th>
                    </tr>
                </thead>
                <tbody id="cryptoBody"></tbody>
            </table>
        </div>
        
        <!-- COMMODITIES TAB -->
        <div id="commodities" class="tab-content">
            <div class="summary-cards">
                <div class="card">
                    <div class="card-title">Total Spent</div>
                    <div class="card-value" id="commodSpent">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total Worth</div>
                    <div class="card-value" id="commodWorth">$--,---</div>
                </div>
                <div class="card">
                    <div class="card-title">Total P&L</div>
                    <div class="card-value" id="commodPnL">$---</div>
                    <div class="card-change" id="commodROI">---%</div>
                </div>
            </div>
            
            <div class="section-title">Commodities Holdings</div>
            <table>
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Quantity</th>
                        <th>Avg Price</th>
                        <th>Current Price</th>
                        <th>Total Spent</th>
                        <th>Total Worth</th>
                        <th>ROI %</th>
                        <th>ROI $</th>
                    </tr>
                </thead>
                <tbody id="commodBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Configuration
        // Stock data with current prices (update these manually or they'll use fallback)
        const STOCK_DATA = [
            { ticker: 'PEP', shares: 10, avgCost: 150.42, currentPriceUSD: 164.50 },
            { ticker: 'KO', shares: 15, avgCost: 58.67, currentPriceUSD: 61.50 }
        ];
        
        let portfolioData = {};
        let USD_TO_EUR = 0.858; // You can update this manually or it will use this fallback
        
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Utility functions
        function fmt(value, symbol = '$') {
            return symbol + value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        function pct(value) {
            return value.toFixed(2) + '%';
        }
        
        // Try to fetch exchange rate (optional - will use fallback if it fails)
        async function fetchExchangeRate() {
            console.log('Using fallback exchange rate:', USD_TO_EUR);
            // Removed CORS proxy dependency
        }
        
        // Fetch from Google Sheets API
        async function fetchSheetData(sheetName) {
            try {
                const GOOGLE_API_KEY = 'AIzaSyBfoJLdmvVKBIDqVVa_ynzLSeW-a9UrKpM';
                const SHEET_ID = '1ITRBBv2AlAxdOwvG-mgJLah7W-BJWE7Awpxz3WT2gQ0';
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(sheetName)}?key=${GOOGLE_API_KEY}`;
                console.log(`ðŸ“¥ Fetching ${sheetName}...`);
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.values) {
                    const headers = data.values[0];
                    const rows = data.values.slice(1);
                    
                    const parsed = rows.map(row => {
                        const obj = {};
                        headers.forEach((header, i) => {
                            obj[header] = row[i] || '';
                        });
                        return obj;
                    });
                    
                    console.log(`âœ… ${sheetName}: ${parsed.length} rows`);
                    return parsed;
                }
            } catch (error) {
                console.error(`âŒ ${sheetName} fetch failed:`, error);
                alert(`Failed to load ${sheetName}. Check API key and sheet name.`);
            }
            return [];
        }
        
        // Process Stocks (no API calls needed)
        async function processStocks() {
            await fetchExchangeRate();
            
            let totalSpent = 0;
            let totalWorth = 0;
            
            const holdings = STOCK_DATA.map(holding => {
                const currentPrice = holding.currentPriceUSD * USD_TO_EUR;
                const costBasis = holding.shares * holding.avgCost;
                const marketValue = holding.shares * currentPrice;
                const pnl = marketValue - costBasis;
                const roi = (pnl / costBasis) * 100;
                
                totalSpent += costBasis;
                totalWorth += marketValue;
                
                console.log(`âœ… ${holding.ticker}: â‚¬${currentPrice.toFixed(2)}`);
                return { ...holding, currentPrice, costBasis, marketValue, pnl, roi };
            });
            
            const totalPnL = totalWorth - totalSpent;
            const totalROI = (totalPnL / totalSpent) * 100;
            
            portfolioData.stocks = { holdings, totalSpent, totalWorth, totalPnL, totalROI };
            renderStocks();
        }
        
        // Process Crypto
        async function processCrypto() {
            const data = await fetchSheetData('Crypto Portfolio');
            
            let totalSpent = 0;
            let totalValue = 0;
            
            const holdings = data.filter(row => row['Asset']).map(row => {
                const spent = parseFloat(row['Total Spent']) || 0;
                const value = parseFloat(row['Current Value']) || 0;
                const unrealizedPnL = parseFloat(row['Unrealized PnL']) || 0;
                const pnlPercent = parseFloat(row['% PnL']) || 0;
                
                totalSpent += spent;
                totalValue += value;
                
                return {
                    asset: row['Asset'],
                    amount: parseFloat(row['# Amount']) || 0,
                    avgPrice: parseFloat(row['Avg Buy Price']) || 0,
                    price: parseFloat(row['Price']) || 0,
                    totalSpent: spent,
                    currentValue: value,
                    unrealizedPnL,
                    pnlPercent
                };
            });
            
            const totalPnL = totalValue - totalSpent;
            const totalROI = totalSpent > 0 ? (totalPnL / totalSpent) * 100 : 0;
            
            portfolioData.crypto = { holdings, totalSpent, totalValue, totalPnL, totalROI };
            renderCrypto();
        }
        
        // Process Commodities
        async function processCommodities() {
            const data = await fetchSheetData('Commodities');
            
            let totalSpent = 0;
            let totalWorth = 0;
            
            const holdings = data.filter(row => row['ASSET']).map(row => {
                const spent = parseFloat(row['TOTAL SPENT']) || 0;
                const worth = parseFloat(row['TOTAL WORTH']) || 0;
                const roiDollar = parseFloat(row['ROI $']) || 0;
                const roiPercent = parseFloat(row['ROI %']) || 0;
                
                totalSpent += spent;
                totalWorth += worth;
                
                return {
                    asset: row['ASSET'],
                    qty: parseFloat(row['QTY']) || 0,
                    avgPrice: parseFloat(row['AVG PRICE']) || 0,
                    price: parseFloat(row['PRICE']) || 0,
                    totalSpent: spent,
                    totalWorth: worth,
                    roiDollar,
                    roiPercent
                };
            });
            
            const totalPnL = totalWorth - totalSpent;
            const totalROI = totalSpent > 0 ? (totalPnL / totalSpent) * 100 : 0;
            
            portfolioData.commodities = { holdings, totalSpent, totalWorth, totalPnL, totalROI };
            renderCommodities();
        }
        
        // Render functions
        function renderStocks() {
            const d = portfolioData.stocks;
            
            document.getElementById('stocksSpent').textContent = fmt(d.totalSpent, 'â‚¬');
            document.getElementById('stocksWorth').textContent = fmt(d.totalWorth, 'â‚¬');
            document.getElementById('stocksPnL').textContent = fmt(d.totalPnL, 'â‚¬');
            document.getElementById('stocksPnL').className = 'card-value ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            document.getElementById('stocksROI').textContent = pct(d.totalROI);
            document.getElementById('stocksROI').className = 'card-change ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            
            const tbody = document.getElementById('stocksBody');
            tbody.innerHTML = '';
            
            d.holdings.forEach(h => {
                const row = `
                    <tr>
                        <td><span class="asset-name">${h.ticker}</span></td>
                        <td>${h.shares.toFixed(2)}</td>
                        <td>â‚¬${h.avgCost.toFixed(2)}</td>
                        <td>â‚¬${h.currentPrice.toFixed(2)}</td>
                        <td>â‚¬${h.marketValue.toFixed(2)}</td>
                        <td class="${h.pnl >= 0 ? 'positive-value' : 'negative-value'}">â‚¬${h.pnl.toFixed(2)}</td>
                        <td class="${h.roi >= 0 ? 'positive-value' : 'negative-value'}">${pct(h.roi)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function renderCrypto() {
            const d = portfolioData.crypto;
            
            document.getElementById('cryptoSpent').textContent = fmt(d.totalSpent);
            document.getElementById('cryptoValue').textContent = fmt(d.totalValue);
            document.getElementById('cryptoPnL').textContent = fmt(d.totalPnL);
            document.getElementById('cryptoPnL').className = 'card-value ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            document.getElementById('cryptoROI').textContent = pct(d.totalROI);
            document.getElementById('cryptoROI').className = 'card-change ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            
            const tbody = document.getElementById('cryptoBody');
            tbody.innerHTML = '';
            
            d.holdings.forEach(h => {
                const row = `
                    <tr>
                        <td><span class="asset-name">${h.asset}</span></td>
                        <td>${h.amount.toFixed(4)}</td>
                        <td>$${h.avgPrice.toFixed(2)}</td>
                        <td>$${h.price.toFixed(2)}</td>
                        <td>$${h.totalSpent.toFixed(2)}</td>
                        <td>$${h.currentValue.toFixed(2)}</td>
                        <td class="${h.unrealizedPnL >= 0 ? 'positive-value' : 'negative-value'}">$${h.unrealizedPnL.toFixed(2)}</td>
                        <td class="${h.pnlPercent >= 0 ? 'positive-value' : 'negative-value'}">${pct(h.pnlPercent)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function renderCommodities() {
            const d = portfolioData.commodities;
            
            document.getElementById('commodSpent').textContent = fmt(d.totalSpent);
            document.getElementById('commodWorth').textContent = fmt(d.totalWorth);
            document.getElementById('commodPnL').textContent = fmt(d.totalPnL);
            document.getElementById('commodPnL').className = 'card-value ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            document.getElementById('commodROI').textContent = pct(d.totalROI);
            document.getElementById('commodROI').className = 'card-change ' + (d.totalPnL >= 0 ? 'positive' : 'negative');
            
            const tbody = document.getElementById('commodBody');
            tbody.innerHTML = '';
            
            d.holdings.forEach(h => {
                const row = `
                    <tr>
                        <td><span class="asset-name">${h.asset}</span></td>
                        <td>${h.qty.toFixed(4)}</td>
                        <td>$${h.avgPrice.toFixed(2)}</td>
                        <td>$${h.price.toFixed(2)}</td>
                        <td>$${h.totalSpent.toFixed(2)}</td>
                        <td>$${h.totalWorth.toFixed(2)}</td>
                        <td class="${h.roiPercent >= 0 ? 'positive-value' : 'negative-value'}">${pct(h.roiPercent)}</td>
                        <td class="${h.roiDollar >= 0 ? 'positive-value' : 'negative-value'}">$${h.roiDollar.toFixed(2)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        function renderOverview() {
            const s = portfolioData.stocks;
            const c = portfolioData.crypto;
            const co = portfolioData.commodities;
            
            const stocksUSD = s.totalWorth / USD_TO_EUR;
            const stocksSpentUSD = s.totalSpent / USD_TO_EUR;
            const stocksPnLUSD = s.totalPnL / USD_TO_EUR;
            
            const totalValue = stocksUSD + c.totalValue + co.totalWorth;
            const totalInvested = stocksSpentUSD + c.totalSpent + co.totalSpent;
            const totalPnL = totalValue - totalInvested;
            const totalROI = (totalPnL / totalInvested) * 100;
            
            document.getElementById('overviewTotal').textContent = fmt(totalValue);
            document.getElementById('overviewInvested').textContent = fmt(totalInvested);
            document.getElementById('overviewPnL').textContent = fmt(totalPnL);
            document.getElementById('overviewPnL').className = 'card-value ' + (totalPnL >= 0 ? 'positive' : 'negative');
            document.getElementById('overviewROI').textContent = pct(totalROI);
            document.getElementById('overviewROI').className = 'card-change ' + (totalPnL >= 0 ? 'positive' : 'negative');
            
            document.getElementById('stocksAlloc').textContent = fmt(stocksUSD);
            document.getElementById('stocksPercent').textContent = pct((stocksUSD / totalValue) * 100);
            document.getElementById('cryptoAlloc').textContent = fmt(c.totalValue);
            document.getElementById('cryptoPercent').textContent = pct((c.totalValue / totalValue) * 100);
            document.getElementById('commodAlloc').textContent = fmt(co.totalWorth);
            document.getElementById('commodPercent').textContent = pct((co.totalWorth / totalValue) * 100);
            
            const tbody = document.getElementById('overviewTable');
            tbody.innerHTML = `
                <tr>
                    <td><span class="asset-name">Stocks</span></td>
                    <td>${fmt(stocksSpentUSD)}</td>
                    <td>${fmt(stocksUSD)}</td>
                    <td class="${stocksPnLUSD >= 0 ? 'positive-value' : 'negative-value'}">${fmt(stocksPnLUSD)}</td>
                    <td class="${s.totalROI >= 0 ? 'positive-value' : 'negative-value'}">${pct(s.totalROI)}</td>
                </tr>
                <tr>
                    <td><span class="asset-name">Crypto</span></td>
                    <td>${fmt(c.totalSpent)}</td>
                    <td>${fmt(c.totalValue)}</td>
                    <td class="${c.totalPnL >= 0 ? 'positive-value' : 'negative-value'}">${fmt(c.totalPnL)}</td>
                    <td class="${c.totalROI >= 0 ? 'positive-value' : 'negative-value'}">${pct(c.totalROI)}</td>
                </tr>
                <tr>
                    <td><span class="asset-name">Commodities</span></td>
                    <td>${fmt(co.totalSpent)}</td>
                    <td>${fmt(co.totalWorth)}</td>
                    <td class="${co.totalPnL >= 0 ? 'positive-value' : 'negative-value'}">${fmt(co.totalPnL)}</td>
                    <td class="${co.totalROI >= 0 ? 'positive-value' : 'negative-value'}">${pct(co.totalROI)}</td>
                </tr>
            `;
        }
        
        // Initialize
        async function init() {
            console.log('ðŸš€ Loading portfolio...');
            
            await Promise.all([
                processStocks(),
                processCrypto(),
                processCommodities()
            ]);
            
            renderOverview();
            
            document.getElementById('loadingOverlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 500);
            
            console.log('âœ… Dashboard loaded!');
        }
        
        // Shooting stars
        function createStar() {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.left = Math.random() * window.innerWidth + 'px';
            star.style.top = Math.random() * (window.innerHeight / 2) + 'px';
            star.style.animationDuration = (0.8 + Math.random() * 1.7) + 's';
            document.getElementById('shootingStars').appendChild(star);
            setTimeout(() => star.remove(), 3000);
        }
        
        setInterval(() => {
            if (Math.random() > 0.3) createStar();
        }, 400);
        
        // Start
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
